<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../css/layui.css">
    <style>
        .layui-table-cell .layui-form-checkbox[lay-skin="primary"] {
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<div>

    <div class="layui-inline">
        <input type="text" class="layui-input" id="searchTimeRange" placeholder="请选择搜索时间范围">
    </div>
    <button type="button" class="layui-btn">搜索</button>

    <table id="table" lay-filter="table"></table>

    <script type="text/html" id="monitorinfoTool">
        <a class="layui-btn layui-btn-xs" lay-event="image1View">查看照片1</a>
        <a class="layui-btn layui-btn-xs" lay-event="image2View">查看照片2</a>
        <a class="layui-btn layui-btn-xs" lay-event="msgView">查看信息</a>
    </script>
    <script src="../layui.js"></script>
    <script th:inline="none">
        layui.use(['table', 'layer', 'laydate', 'carousel', 'util'], function () {
            var carousel = layui.carousel;
            var table = layui.table;
            var laydate = layui.laydate;
            var util = layui.util;

            var image1Url;
            var image2Url;
            table.render({
                elem: '#table'
                , url: 'http://192.168.3.120:8080/ExtractLoadV01/Query' // 数据接口
                , page: true // 开启分页
                , width: 1000
                , limits: [10]
                , cols: [[ //表头
                    {type: 'numbers', title: '序号'}
                    , {
                        field: 'datetime', title: '记录时间', sort: true, templet: function (data) {
                            return layui.util.toDateString(data.datetime);
                        }
                    }
                    , {field: 'stationid', title: '站点名称'}
                    , {field: 'deviceip', title: '设备 IP 地址'}
                    , {fixed: 'right', minWidth: 280, align: 'center', toolbar: '#monitorinfoTool'}
                ]]
                , where: {
                    lcommand: 12368
                }
                , headers: {
                    'Access-Control-Allow-Origin': '*'
                }
                // , parseData: function (res) {
                //     return {
                //         "code": res.status, //解析接口状态
                //         "msg": res.message, //解析提示文本
                //         "count": res.total, //解析数据长度
                //         "data": res.data.item //解析数据列表
                //     };
                // }
                , done: function (res, curr, count) {
                    console.log(res);
                }
            });


            laydate.render({
                elem: '#searchTimeRange'
                , range: true
                // , btns: ['clear', 'now', 'confirm']
                , max: 0
                , done: function (value, date, endDate) {
                    console.log(date.year + "-" + date.month + "-" + date.date + " " + date.hours + ":" + date.minutes + ":" + date.seconds);
                    console.log(value);
                    if (value != null) {
                        table.reload('table', {
                            page: {curr: 1}
                            , where: {
                                startDate: value
                                , endDate: endDate
                            }
                        });
                    }
                }
            });

            // // 搜索时重载
            // var $ = layui.$, active = {
            //     reload: function () {
            //         var searchValue = $('#searchValue');
            //
            //         //执行重载
            //         table.reload('roleTable', {
            //             page: {
            //                 curr: 1 //重新从第 1 页开始
            //             }
            //             , where: {
            //                 roleName: searchValue.val()
            //             }
            //         }, 'data');
            //     }
            // };
            // // 搜索按钮响应
            // $('#searchBtn').on('click', function () {
            //     var type = $(this).data('type');
            //     active[type] ? active[type].call(this) : '';
            //     $('#searchValue').val("");
            // });

            table.on('tool(table)', function (obj) {
                var data = obj.data;
                var layEvent = obj.event;
                var tr = obj.tr;

                var layer = layui.layer;

                var image1HTML = '<img style="padding: 10px" src="' + image1Url + '"/>';
                var image2HTML = '<img style="padding: 10px" src="' + image2Url + '"/>';

                var content = '<div class="layui-carousel" id="imageView"><div carousel-item>' +
                    '<div>' + image1HTML + '</div>' +
                    '<div>' + image2HTML + '</div>' +
                    '</div></div>';

                var initImgIndex; // 默认图片
                if (layEvent === 'image1View') {
                    initImgIndex = 0;
                } else if (layEvent === 'image2View') {
                    initImgIndex = 1;
                } else if (layEvent === 'msgView') {
                    content = '<div style="padding: 10px"><p>' + obj.data['infoData'] + '</p></div>'
                }
                layer.open({
                    type: 1
                    , offset: ['20px', '200px']
                    , shadeClose: true
                    , title: false
                    , content: content
                    , index: initImgIndex
                    , success: function (layero, index) {
                        // layer.style(index, {
                        //     background: 'transparent'
                        // });
                        carousel.render({
                            elem: '#imageView'
                            // , width: '400px'
                            // , height: '400px'
                            , arrow: 'always'
                            , autoplay: false
                        });
                    }
                });
            })
        });


    </script>
</div>
</html>